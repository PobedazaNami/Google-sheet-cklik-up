// // ===============================
// // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
// // ===============================

// // ID Google –¢–∞–±–ª–∏—Ü—ã
// const SPREADSHEET_ID = '1lYYAxNPhofX1bqnpsT9bC0c5EMxwI5Y-prIxXEsfmGo';

// // –ò–º–µ–Ω–∞ –ª–∏—Å—Ç–æ–≤
// const LOG_SHEET_NAME = '–õ–æ–≥–∏';
// const TECH_REQUESTS_SHEET_NAME = 'Tech requests'; // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–º—è –ª–∏—Å—Ç–∞ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

// // API-–∫–ª—é—á ClickUp (–ù–ï –•–ê–†–î–ö–û–î–ò–¢–ï API-–ö–õ–Æ–ß –í –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–û–ú –ö–û–î–ï)
// const CLICKUP_API_KEY = '–∞–ø–∏ –∫–ª—é—á'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –Ω–æ–≤—ã–π API-–∫–ª—é—á

// // ID —Å–ø–∏—Å–∫–∞ ClickUp
// const CLICKUP_LIST_ID = '901204061958'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π ID –∏–∑ –≤–∞—à–∏—Ö –ª–æ–≥–æ–≤

// // ===============================
// // –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è ClickUp (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID)
// // ===============================
// const CUSTOM_FIELD_REQUEST_TYPE_ID = '2b023b60-6e13-479b-985a-9346e29f41b3'; // üìû Request Type
// const CUSTOM_FIELD_AGENCY_ID = 'c5f1c5e4-62e4-4a41-a601-36c500615706'; // üõÇ Agency

// // ===============================
// // –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
// // ===============================

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç.
//  * @param {string} message –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
//  */
// function logToSheet(message) {
//   try {
//     var spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
//     var logSheet = spreadsheet.getSheetByName(LOG_SHEET_NAME);

//     if (!logSheet) {
//       logSheet = spreadsheet.insertSheet(LOG_SHEET_NAME);
//       // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
//       logSheet.appendRow(['–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è', '–°–æ–æ–±—â–µ–Ω–∏–µ']);
//     }

//     logSheet.appendRow([new Date(), message]);
//   } catch (error) {
//     // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥, –∏—Å–ø–æ–ª—å–∑—É–µ–º Logger –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
//     Logger.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥: ' + error.message);
//   }
// }

// // ===============================
// // –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
// // ===============================

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö POST-–∑–∞–ø—Ä–æ—Å–æ–≤ (–≤–µ–±—Ö—É–∫–æ–≤).
//  * @param {Object} e –û–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è.
//  * @returns {TextOutput} –û—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
//  */
// function doPost(e) {
//   logToSheet('–§—É–Ω–∫—Ü–∏—è doPost –≤—ã–∑–≤–∞–Ω–∞');

//   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
//   if (!e || !e.postData || !e.postData.contents) {
//     logToSheet('–û—à–∏–±–∫–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ');
//     return ContentService
//       .createTextOutput(JSON.stringify({ status: 'error', message: 'No data received' }))
//       .setMimeType(ContentService.MimeType.JSON);
//   }

//   try {
//     var data = JSON.parse(e.postData.contents);
//     logToSheet('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ' + JSON.stringify(data));

//     // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
//     if (data.event === 'taskUpdated' || data.event === 'taskStatusUpdated') {
//       logToSheet('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏');
//       var taskId = data.task_id;

//       // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏—è task_id
//       if (taskId) {
//         processTaskUpdated(taskId);
//       } else {
//         logToSheet('–û—à–∏–±–∫–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç task_id –≤ –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞');
//       }
//     } else {
//       logToSheet('–ü–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è taskUpdated –∏–ª–∏ taskStatusUpdated, –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç task_id.');
//     }
//   } catch (error) {
//     logToSheet('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
//     return ContentService
//       .createTextOutput(JSON.stringify({ status: 'error', message: error.message }))
//       .setMimeType(ContentService.MimeType.JSON);
//   }

//   logToSheet('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ doPost');
//   return ContentService
//     .createTextOutput(JSON.stringify({ status: 'success' }))
//     .setMimeType(ContentService.MimeType.JSON);
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.
//  * @param {string} taskId ID –∑–∞–¥–∞—á–∏.
//  */
// function processTaskUpdated(taskId) {
//   // –ü–æ–ª—É—á–∞–µ–º –ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
//   var lock = LockService.getScriptLock();
//   try {
//     // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ª–æ–∫, –∂–¥–µ–º –¥–æ 10 —Å–µ–∫—É–Ω–¥
//     lock.waitLock(10000);
//   } catch (e) {
//     logToSheet('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ª–æ–∫: ' + e.message);
//     return;
//   }

//   try {
//     logToSheet(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ —Å ID: ${taskId}`);

//     var spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
//     var sheet = spreadsheet.getSheetByName(TECH_REQUESTS_SHEET_NAME);

//     if (!sheet) {
//       logToSheet(`–õ–∏—Å—Ç "${TECH_REQUESTS_SHEET_NAME}" –Ω–µ –Ω–∞–π–¥–µ–Ω.`);
//       return;
//     }

//     // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
//     if (isTaskInSheet(taskId, sheet)) {
//       logToSheet(`–ó–∞–¥–∞—á–∞ —Å ID: ${taskId} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.`);
//       return;
//     }

//     // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ –∏–∑ ClickUp
//     var task = getTaskDetails(taskId);
//     if (!task) {
//       logToSheet(`–ó–∞–¥–∞—á–∞ —Å ID: ${taskId} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.`);
//       return;
//     }

//     var status = getTaskStatus(task);
//     logToSheet(`–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏: ${status}`);

//     if (status.toLowerCase() === 'open') {
//       logToSheet(`–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ ${taskId} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ "Open". –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ.`);

//       // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Task ID –≤ —Ç–∞–±–ª–∏—Ü–µ
//       if (isTaskInSheet(taskId, sheet)) {
//         logToSheet(`–ó–∞–¥–∞—á–∞ —Å ID: ${taskId} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.`);
//         return;
//       }

//       // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ —Ç–∞–±–ª–∏—Ü—É
//       addTaskToSheet(task, sheet);
//       logToSheet(`–ó–∞–¥–∞—á–∞ ${taskId} —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É.`);
//     } else {
//       logToSheet(`–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ ${taskId} –Ω–µ "Open". –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.`);
//     }
//   } finally {
//     // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ª–æ–∫
//     lock.releaseLock();
//   }
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ –∏–∑ ClickUp.
//  * @param {string} taskId ID –∑–∞–¥–∞—á–∏.
//  * @returns {Object} –û–±—ä–µ–∫—Ç –∑–∞–¥–∞—á–∏ –∏–ª–∏ null, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
//  */
// function getTaskDetails(taskId) {
//   if (!CLICKUP_API_KEY) {
//     logToSheet('–û—à–∏–±–∫–∞: CLICKUP_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.');
//     return null;
//   }

//   var url = `https://api.clickup.com/api/v2/task/${taskId}`;

//   var options = {
//     'method': 'get',
//     'headers': {
//       'Authorization': CLICKUP_API_KEY,
//       'Content-Type': 'application/json'
//     },
//     'muteHttpExceptions': true
//   };

//   try {
//     var response = UrlFetchApp.fetch(url, options);
//     var responseCode = response.getResponseCode();
//     var responseBody = response.getContentText();

//     logToSheet(`–û—Ç–≤–µ—Ç API –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ ${taskId}: –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ ${responseCode}, –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: ${responseBody}`);

//     if (responseCode === 200) {
//       var data = JSON.parse(responseBody);
//       return data;
//     } else {
//       logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ ${taskId}. –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: ${responseCode}. –û—Ç–≤–µ—Ç: ${responseBody}`);
//       return null;
//     }
//   } catch (error) {
//     logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ ${taskId}: ${error.message}`);
//     return null;
//   }
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏.
//  * @param {Object} task –û–±—ä–µ–∫—Ç –∑–∞–¥–∞—á–∏.
//  * @returns {string} –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏.
//  */
// function getTaskStatus(task) {
//   return task.status ? task.status.status : '';
// }

// // ===============================
// // –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å ClickUp
// // ===============================

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º OPEN –∏–∑ ClickUp –∏ –∑–∞–ø–∏—Å–∏ –∏—Ö –≤ Google –¢–∞–±–ª–∏—Ü—É.
//  */
// function getOpenClickUpTasks() {
//   logToSheet('getOpenClickUpTasks –≤—ã–∑–≤–∞–Ω–∞');

//   if (!CLICKUP_API_KEY) {
//     logToSheet('–û—à–∏–±–∫–∞: CLICKUP_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.');
//     return;
//   }

//   var apiKey = CLICKUP_API_KEY;
//   var listId = CLICKUP_LIST_ID;
//   var url = `https://api.clickup.com/api/v2/list/${listId}/task?statuses[]=Open`;

//   var options = {
//     'method': 'get',
//     'headers': {
//       'Authorization': apiKey
//     },
//     'muteHttpExceptions': true
//   };

//   try {
//     var response = UrlFetchApp.fetch(url, options);
//     var responseCode = response.getResponseCode();
//     var responseBody = response.getContentText();

//     logToSheet(`–û—Ç–≤–µ—Ç API –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Open": –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ ${responseCode}, –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: ${responseBody}`);

//     if (responseCode === 200) {
//       var data = JSON.parse(responseBody);

//       if (!data.tasks || data.tasks.length === 0) {
//         logToSheet('–ù–µ—Ç –∑–∞–¥–∞—á —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Open".');
//         return;
//       }

//       var tasks = data.tasks;
//       logToSheet(`–ù–∞–π–¥–µ–Ω–æ ${tasks.length} –∑–∞–¥–∞—á —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Open".`);

//       var spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
//       var sheet = spreadsheet.getSheetByName(TECH_REQUESTS_SHEET_NAME);

//       if (!sheet) {
//         sheet = spreadsheet.insertSheet(TECH_REQUESTS_SHEET_NAME);
//         // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å —Å—Ç–æ–ª–±—Ü–∞ D
//         sheet.appendRow([
//           '', '', '',
//           'Request ID',
//           'Request Type',
//           'Request Date',
//           'Telegram Tag',
//           'Buyer Real Name',
//           'Binom user name',
//           'Binom campaign id',
//           'TT account id',
//           'FB account id',
//           '', '', 'Comment', 'Custom Field 1', 'Custom Field 2', '', '', 'Task ID'
//         ]);
//         // –ü–æ—è—Å–Ω–µ–Ω–∏—è:
//         // –°—Ç–æ–ª–±—Ü—ã A-C: –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—É—Å—Ç—ã–º–∏
//         // –°—Ç–æ–ª–±—Ü—ã O, P, Q, S: –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—É—Å—Ç—ã–º–∏ –∏–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö
//       }

//       tasks.forEach(function(task) {
//         // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–¥–∞—á–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ ID
//         if (!isTaskInSheet(task.id, sheet)) {
//           addTaskToSheet(task, sheet);
//         } else {
//           logToSheet(`–ó–∞–¥–∞—á–∞ —Å ID: ${task.id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.`);
//         }
//       });
//     } else {
//       logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Open". –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: ${responseCode}. –û—Ç–≤–µ—Ç: ${responseBody}`);
//     }
//   } catch (error) {
//     logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á –∏–∑ ClickUp: ${error.message}`);
//   }
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–¥–∞—á–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º ID –≤ –ª–∏—Å—Ç–µ.
//  * @param {string} taskId ID –∑–∞–¥–∞—á–∏.
//  * @param {Sheet} sheet –õ–∏—Å—Ç Google –¢–∞–±–ª–∏—Ü—ã.
//  * @returns {boolean} –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞, –∏–Ω–∞—á–µ false.
//  */
// function isTaskInSheet(taskId, sheet) {
//   var lastRow = sheet.getLastRow();
//   if (lastRow < 2) return false; // –ï—Å–ª–∏ –º–µ–Ω—å—à–µ –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ (–∑–∞–≥–æ–ª–æ–≤–∫–∏), –∑–∞–¥–∞—á –µ—â—ë –Ω–µ—Ç.

//   var taskIds = sheet.getRange(2, 20, lastRow - 1, 1).getValues().flat(); // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ ID –∑–∞–¥–∞—á –≤ –º–∞—Å—Å–∏–≤–µ (—Å—Ç–æ–ª–±–µ—Ü T - 20)

//   // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
//   logToSheet(`–ü—Ä–æ–≤–µ—Ä–∫–∞ Task ID: ${taskId} –≤ —Ç–∞–±–ª–∏—Ü–µ. –ù–∞–π–¥–µ–Ω–Ω—ã–µ Task IDs: ${taskIds.join(', ')}`);

//   // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Å—Ç—Ä–æ–∫–µ
//   return taskIds.some(id => id.toString().trim() === taskId.toString().trim());
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ Google –¢–∞–±–ª–∏—Ü—É.
//  * @param {Object} task –û–±—ä–µ–∫—Ç –∑–∞–¥–∞—á–∏ –∏–∑ ClickUp.
//  * @param {Sheet} sheet –õ–∏—Å—Ç Google –¢–∞–±–ª–∏—Ü—ã.
//  */
// function addTaskToSheet(task, sheet) {
//   var id = task.id;

//   // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º ID —É–∂–µ –µ—Å—Ç—å, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
//   if (isTaskInSheet(id, sheet)) {
//     logToSheet(`–ó–∞–¥–∞—á–∞ —Å ID: ${id} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ.`);
//     return;
//   }

//   var description = task.text_content || task.description || '';

//   // –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
//   var requestDate = extractField(description, 'Request Date');
//   var telegramTag = extractField(description, 'Telegram Tag');
//   var buyerRealName = extractField(description, 'Buyer Real Name');
//   var binomUserName = extractField(description, 'Binom user name');
//   var binomCampaignId = extractField(description, 'Binom campaign id');
//   var ttAccountId = extractField(description, 'TT account id');
//   var fbAccountId = extractField(description, 'FB account id');
//   var comment = extractField(description, 'Comment');

//   // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
//   var customField1 = getCustomFieldValueById(task.custom_fields, CUSTOM_FIELD_REQUEST_TYPE_ID);
//   var customField2 = getCustomFieldValueById(task.custom_fields, CUSTOM_FIELD_AGENCY_ID);

//   // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
//   logToSheet(`Custom Field 1 Value: ${customField1}`);
//   logToSheet(`Custom Field 2 Value: ${customField2}`);

//   logToSheet(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ —Ç–∞–±–ª–∏—Ü—É: Request ID=-, Request Type=${customField1}, Request Date=${requestDate}, Telegram Tag=${telegramTag}, Buyer Real Name=${buyerRealName}, Binom user name=${binomUserName}, Binom campaign id=${binomCampaignId}, TT account id=${ttAccountId}, FB account id=${fbAccountId}, Comment=${comment}, Custom Field 1=${customField1}, Custom Field 2=${customField2}, Task ID=${id}`);

//   // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É
//   var newRow = [
//     '', '', '', // –°—Ç–æ–ª–±—Ü—ã A-C: –ø—É—Å—Ç—ã–µ
//     '-', // Request ID (–°—Ç–æ–ª–±–µ—Ü D - 4), —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ '-', —Ç–∞–∫ –∫–∞–∫ Task ID –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å
//     customField1, // Request Type (–°—Ç–æ–ª–±–µ—Ü E - 5)
//     requestDate, // Request Date (–°—Ç–æ–ª–±–µ—Ü F - 6)
//     telegramTag, // Telegram Tag (–°—Ç–æ–ª–±–µ—Ü G - 7)
//     buyerRealName, // Buyer Real Name (–°—Ç–æ–ª–±–µ—Ü H - 8)
//     binomUserName, // Binom user name (–°—Ç–æ–ª–±–µ—Ü I - 9)
//     binomCampaignId, // Binom campaign id (–°—Ç–æ–ª–±–µ—Ü J - 10)
//     ttAccountId, // TT account id (–°—Ç–æ–ª–±–µ—Ü K - 11)
//     fbAccountId, // FB account id (–°—Ç–æ–ª–±–µ—Ü L - 12)
//     '', '', // –°—Ç–æ–ª–±—Ü—ã M-N: –ø—É—Å—Ç—ã–µ
//     comment, // Comment (–°—Ç–æ–ª–±–µ—Ü O - 15)
//     customField1, // Custom Field 1 (–°—Ç–æ–ª–±–µ—Ü P - 16)
//     customField2, // Custom Field 2 (–°—Ç–æ–ª–±–µ—Ü Q - 17)
//     '', '', // –°—Ç–æ–ª–±—Ü—ã R-S: –ø—É—Å—Ç—ã–µ
//     id // Task ID (–°—Ç–æ–ª–±–µ—Ü T - 20)
//   ];

//   // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
//   logToSheet(`–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${newRow.join(', ')}`);

//   // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É
//   sheet.appendRow(newRow);
//   logToSheet(`–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É —Å ID: ${id}`);
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è.
//  * @param {string} text –¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è.
//  * @param {string} fieldName –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è.
//  * @returns {string} –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –∏–ª–∏ '-'.
//  */
// function extractField(text, fieldName) {
//   var regex = new RegExp(fieldName + ':\\s*(.*)', 'i');
//   var match = text.match(regex);
//   if (match && match[1].trim() !== '') {
//     return match[1].trim();
//   } else {
//     return '-';
//   }
// }

// // ===============================
// // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
// // ===============================

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª—è –ø–æ ID
//  * @param {Array} fields –ú–∞—Å—Å–∏–≤ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –∑–∞–¥–∞—á–∏.
//  * @param {string} fieldId ID –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª—è.
//  * @returns {string} –ó–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª—è –∏–ª–∏ '-' –µ—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
//  */
// function getCustomFieldValueById(fields, fieldId) {
//   var field = fields ? fields.find(f => f.id === fieldId) : null;
//   if (!field) {
//     logToSheet(`–ö–∞—Å—Ç–æ–º–Ω–æ–µ –ø–æ–ª–µ —Å ID "${fieldId}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.`);
//     return '-';
//   }

//   switch (field.type) {
//     case 'drop_down':
//       return field.value && field.value.name ? field.value.name : '-';
//     case 'text':
//       return field.value || '-';
//     case 'date':
//       return field.value ? Utilities.formatDate(new Date(field.value), Session.getScriptTimeZone(), 'dd.MM.yyyy') : '-';
//     case 'number':
//       return field.value !== undefined ? field.value : '-';
//     // –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
//     default:
//       logToSheet(`–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–∏–ø –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª—è —Å ID "${fieldId}": ${field.type}`);
//       return '-';
//   }
// }

// // ===============================
// // –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ
// // ===============================

// /**
//  * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Google –¢–∞–±–ª–∏—Ü—ã.
//  * @param {Object} e –û–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è.
//  */
// function onEdit(e) {
//   try {
//     if (!e) {
//       logToSheet('–°–æ–±—ã—Ç–∏–µ e –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');
//       return;
//     } else {
//       logToSheet(`–û–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è e: ${JSON.stringify(e)}`);
//     }
//     if (!e.range) {
//       logToSheet('–°–≤–æ–π—Å—Ç–≤–æ e.range –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');
//       return;
//     }

//     var sheet = e.range.getSheet();
//     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ—à–ª–∏ –Ω–∞ –ª–∏—Å—Ç–µ 'Tech requests'
//     if (sheet.getName() !== TECH_REQUESTS_SHEET_NAME) {
//       return;
//     }

//     var editedColumn = e.range.getColumn();
//     var editedRow = e.range.getRow();

//     // –í —Ç–µ–∫—É—â–µ–º —Å–ª—É—á–∞–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ ClickUp –æ—Ç–∫–ª—é—á–µ–Ω–æ
//     // –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å—Ç–æ–ª–±—Ü–µ Status, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–∏–∂–µ

//     /*
//     // –ü—Ä–∏–º–µ—Ä: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–µ F (6-–π —Å—Ç–æ–ª–±–µ—Ü)
//     if (editedColumn === 6 && editedRow > 1) { // –°—Ç–æ–ª–±–µ—Ü F: Status
//       // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∏–∑ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —è—á–µ–π–∫–∏
//       var newStatus = e.range.getValue();
//       if (!newStatus) {
//         logToSheet(`–ù–µ—Ç –Ω–æ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Å—Ç—Ä–æ–∫–µ ${editedRow}`);
//         return;
//       }

//       // –ü–æ–ª—É—á–∞–µ–º ID –∑–∞–¥–∞—á–∏ –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ T (20-–π —Å—Ç–æ–ª–±–µ—Ü) —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–∏
//       var taskId = sheet.getRange(editedRow, 20).getValue(); // –°—Ç–æ–ª–±–µ—Ü T: Task ID
//       if (taskId) {
//         // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –≤ ClickUp
//         updateClickUpTaskStatus(taskId.toString().trim(), newStatus.toString().trim());
//       } else {
//         // –õ–æ–≥–∏—Ä—É–µ–º, –µ—Å–ª–∏ ID –∑–∞–¥–∞—á–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
//         logToSheet(`ID –∑–∞–¥–∞—á–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç—Ä–æ–∫–µ ${editedRow}`);
//       }
//     }
//     */
//   } catch (error) {
//     logToSheet(`–û—à–∏–±–∫–∞ –≤ onEdit: ${error.message}`);
//   }
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ –≤ ClickUp —á–µ—Ä–µ–∑ API.
//  * @param {string} taskId ID –∑–∞–¥–∞—á–∏.
//  * @param {string} newStatus –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å.
//  */
// function updateClickUpTaskStatus(taskId, newStatus) {
//   if (!CLICKUP_API_KEY) {
//     logToSheet('–û—à–∏–±–∫–∞: CLICKUP_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.');
//     return;
//   }

//   var apiKey = CLICKUP_API_KEY;
//   var url = `https://api.clickup.com/api/v2/task/${taskId}`;

//   var mappedStatus;
//   try {
//     mappedStatus = mapStatus(newStatus);
//   } catch (error) {
//     logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`);
//     return;
//   }

//   var payload = {
//     "status": mappedStatus
//   };

//   var options = {
//     'method': 'put',
//     'headers': {
//       'Authorization': apiKey,
//       'Content-Type': 'application/json'
//     },
//     'payload': JSON.stringify(payload),
//     'muteHttpExceptions': true
//   };

//   try {
//     var response = UrlFetchApp.fetch(url, options);
//     var responseCode = response.getResponseCode();
//     var responseBody = response.getContentText();

//     logToSheet(`–û—Ç–≤–µ—Ç API –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ ${taskId}: –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ ${responseCode}, –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: ${responseBody}`);

//     if (responseCode === 200) {
//       logToSheet(`–£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ ${taskId} –Ω–∞ "${mappedStatus}".`);
//     } else {
//       logToSheet(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É ${taskId}. –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: ${responseCode}. –û—Ç–≤–µ—Ç: ${responseBody}`);
//     }
//   } catch (error) {
//     logToSheet(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ ${taskId}: ${error.message}`);
//   }
// }

// /**
//  * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å ClickUp.
//  * @param {string} sheetStatus –°—Ç–∞—Ç—É—Å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.
//  * @returns {string} –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å –¥–ª—è ClickUp.
//  */
// function mapStatus(sheetStatus) {
//   var statusMap = {
//     'TO DO': 'to do',
//     'OPEN': 'Open',
//     'IN PROGRESS': 'in progress',
//     'ERROR': 'error',
//     'DONE BY GLOBAL': 'done by global'
//     // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
//   };
  
//   var normalizedStatus = sheetStatus.toUpperCase().trim();
//   var mapped = statusMap[normalizedStatus];
  
//   if (!mapped) {
//     logToSheet(`–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –°—Ç–∞—Ç—É—Å "${sheetStatus}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ mapStatus.`);
//     throw new Error(`–°—Ç–∞—Ç—É—Å "${sheetStatus}" –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º.`);
//   }
  
//   return mapped;
// }
